
<script>
    window.sortTable = function(columnIndex, tableId) {
        const table = document.getElementById(tableId);
        if (!table) {
            console.error(`Table with ID ${tableId} not found.`);
            return;
        }

        const rows = Array.from(table.tBodies[0].rows);
        const isNumeric = !isNaN(rows[0].cells[columnIndex].innerText.trim());
        const direction = table.dataset.sortDirection === "asc" ? -1 : 1;
        table.dataset.sortDirection = table.dataset.sortDirection === "asc" ? "desc" : "asc";

        rows.sort((a, b) => {
            const aValue = isNumeric
                ? parseFloat(a.cells[columnIndex].innerText.trim()) || 0
                : a.cells[columnIndex].textContent.trim().toLowerCase();
            const bValue = isNumeric
                ? parseFloat(b.cells[columnIndex].innerText.trim()) || 0
                : b.cells[columnIndex].textContent.trim().toLowerCase();
            return aValue > bValue ? direction : aValue < bValue ? -direction : 0;
        });

        // Re-append rows to the table body after sorting
        rows.forEach(row => table.tBodies[0].appendChild(row));

        // Force CSS reflow to re-apply styles
        table.offsetHeight;  // This will force a reflow, re-apply styles
    };
</script>
    

{% extends 'base.html' %}

{% block content %}
    <nav>
        <div class="dropdown">
            <button class="dropbtn">Select a year
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                {% for year in all_years %}
                    <a href="{{ url_for('tennis_stats', year=year) }}">{{ year }}</a>
                {% endfor %}
            </div>
        </div>       
    </nav>
    <div class="space-y-8">
    {% if todays_stats %}
    <table id="todaysStatsTable">
        <h1>Today's tennis stats</h1>
        <thead>
            <tr>
                <th class="table-col-rank clickable" scope="col" onclick="sortTable(0, 'todaysStatsTable')">#</th>
                <th class="table-col-player clickable" scope="col" onclick="sortTable(1, 'todaysStatsTable')">Player</th>
                <th class="table-col-stat clickable" scope="col" onclick="sortTable(2, 'todaysStatsTable')">Wins</th>
                <th class="table-col-stat clickable" scope="col" onclick="sortTable(3, 'todaysStatsTable')">Losses</th>
                <th class="table-col-stat clickable" scope="col" onclick="sortTable(4, 'todaysStatsTable')">Win&nbsp;%</th>
                <th class="table-col-stat clickable" scope="col" onclick="sortTable(5, 'todaysStatsTable')">+/-</th>
            </tr>
        </thead>
        <tbody>
            {% for stat in todays_stats %}
            <tr>
                <td class="table-col-rank">{{ loop.index }}</td>
                <td class="table-col-player"><a href="{{ url_for('tennis_player_stats', year=year, name=stat[0] ) }}">{{ stat[0] }}</a></td>
                <td class="table-col-stat">{{ stat[1] }}</td>
                <td class="table-col-stat">{{ stat[2] }}</td>
                <td class="table-col-stat">{{ "{:.2f}".format(stat[3]*100) }}</td>
                {% if stat[4] > 0 %}
                    <td class="table-col-stat">+{{ stat[4] }}</td>
                {% else %}
                    <td class="table-col-stat">{{ stat[4] }}</td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <table id="matchesTable">
        <h1>Today's tennis matches</h1>
        <thead>
            <tr>
                <th class="table-col-rank clickable" scope="col" onclick="sortTable(0, 'matchesTable')">#</th>
                <th class="table-col-date clickable" scope="col" onclick="sortTable(1, 'matchesTable')">Date</th>
                <th class="table-col-player clickable" scope="col" onclick="sortTable(2, 'matchesTable')">Winner</th>
                <th class="table-col-player clickable" scope="col" onclick="sortTable(3, 'matchesTable')">Loser</th>
                <th class="table-col-tennis-score clickable" scope="col" onclick="sortTable(4, 'matchesTable')">Sets</th>
            </tr>
        </thead>
        <tbody>
            {% for match in matches %}
                <tr>
                    <td class="table-col-rank">{{ loop.index }}</td>
                    <td class="table-col-date" title="Time: {{ (match[1])[11:19] }}">{{ (match[1])[0:10] }}</td>
                    <td class="table-col-player"><a href="{{ url_for('tennis_player_stats', year=year, name=match[2] ) }}">{{ match[2] }}</a></td>
                    <td class="table-col-player"><a href="{{ url_for('tennis_player_stats', year=year, name=match[4] ) }}">{{ match[4] }}</a></td>
                    <td class="table-col-tennis-score">{{ match[7] if match[7] else (match[3]|string + '-' + match[5]|string) }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    </div>
    <h1>{% block title %} {{ year }} Tennis stats {% endblock %}</h1>
    <table id="yearlyStatsTable">
        <thead>
            <tr>
                <th class="table-col-rank clickable" scope="col" onclick="sortTable(0, 'yearlyStatsTable')">#</th>
                <th class="table-col-player clickable" scope="col" onclick="sortTable(1, 'yearlyStatsTable')">Player</th>
                <th class="table-col-stat clickable" scope="col" onclick="sortTable(2, 'yearlyStatsTable')">Wins</th>
                <th class="table-col-stat clickable" scope="col" onclick="sortTable(3, 'yearlyStatsTable')">Losses</th>
                <th class="table-col-stat clickable" scope="col" onclick="sortTable(4, 'yearlyStatsTable')">Win&nbsp;%</th>
                <th class="table-col-stat clickable" scope="col" onclick="sortTable(5, 'yearlyStatsTable')">Matches</th>
            </tr>
        </thead>
        <tbody>
            {% for player in stats %}
            <tr>
                <td class="table-col-rank">{{ loop.index }}</td>
                <td class="table-col-player"><a href="{{ url_for('tennis_player_stats', year=year, name=player[0] ) }}">{{ player[0] }}</a></td>
                <td class="table-col-stat">{{ player[1] }}</td>
                <td class="table-col-stat">{{ player[2] }}</td>
                <td class="table-col-stat">{{ "{:.2f}".format(player[3]*100) }}</td>
                <td class="table-col-stat">{{ player[1] + player[2] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
