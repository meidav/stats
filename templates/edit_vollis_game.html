{% extends 'base_admin.html' %}

{% block content %}
    <h1>{% block title %} Edit Game {% endblock %}</h1>
    <table>
       <thead>
            <tr>
                <th scope="col" colspan="1">Date/Updated</th>
                <th scope="col" colspan="1">Winner</th>
                <th scope="col" colspan="1">Loser</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ (game[1])[0:10] }}<br>{{ (game[1])[11:19] }}</td>
                <td><a href="{{ url_for('player_stats', year=year, name=game[2] ) }}">{{ game[2] }}</a></td>
                <td><a href="{{ url_for('player_stats', year=year, name=game[4] ) }}">{{ game[4] }}</a></td>
            </tr>
            <tr>
                <td>{{ (game[6])[0:10] }}<br>{{ (game[6])[11:19] }}</td>
                <td>{{ game[3] }}</td>
                <td>{{ game[5] }}</td>
            </tr>
        </tbody>
    </table>
    <div>
       <form method="post" onsubmit="debugFormData(event)">
              <datalist id="players">
                    {% for player in players %}
                        <option value= "{{ player }}">
                    {% endfor %}
              </datalist>
              <input type="text" name="winner"
                     placeholder="Winner"
                     value="{{ request.form['winner'] if request.form['winner'] else game[2] }}"
                     list="players">
              <input type="text" name="loser"
                     placeholder="Loser"
                     value="{{ request.form['loser'] if request.form['loser'] else game[4] }}"
                     list="players">      
              <input type="number" pattern="[0-9]*" name="winner_score"
                     placeholder="Winner's score"
                     value="{{ request.form['winner_score'] if request.form['winner_score'] else game[3] }}"
                     list="scores">
              <input type="number" pattern="[0-9]*" name="loser_score"
                     placeholder="Loser's score"
                     value="{{ request.form['loser_score'] if request.form['loser_score'] else game[5] }}"
                     list="scores">
              <input type="datetime-local" id="actual_time" name="actual_time"
                     placeholder="Game Date"
                     value="{{ request.form['actual_time'] if request.form['actual_time'] else game[1][:16] }}">
              <input type="submit" value="Submit">
       </form>
    </div>

    <script>
        function debugFormData(event) {
            event.preventDefault();  // Prevent form submission to inspect data
            const winner = document.querySelector('[name="winner"]').value;
            const loser = document.querySelector('[name="loser"]').value;
            const winner_score = document.querySelector('[name="winner_score"]').value;
            const loser_score = document.querySelector('[name="loser_score"]').value;
            let actual_time = document.querySelector('[name="actual_time"]').value;

            // Log the form data to the console for debugging
            console.log("Submitted winner: " + winner);
            console.log("Submitted loser: " + loser);
            console.log("Submitted winner_score: " + winner_score);
            console.log("Submitted loser_score: " + loser_score);
            console.log("Original actual_time: " + actual_time);

            // Fix: Format the date/time value for submission
            if (actual_time) {
                // Remove milliseconds for the datetime-local field
                const formattedActualTime = actual_time + ":00"; // Adjust to 'YYYY-MM-DD HH:MM:SS'
                const finalActualTime = formattedActualTime.replace("T", " "); // Replace T with space
                console.log("Formatted actual_time for input: " + finalActualTime);

                // Update the field with the corrected format
                document.querySelector('[name="actual_time"]').value = finalActualTime;
            }

            // Manually submit the form after adjusting the actual_time value
            const form = document.querySelector('form');
            form.submit();  // Submit the form after all adjustments
        }
    </script>

{% endblock %}
